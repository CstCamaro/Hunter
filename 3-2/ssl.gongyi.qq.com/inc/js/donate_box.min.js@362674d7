/*! user: JIANSHUWANG,time: 2020-06-01 14:30 */!function(e){var a={};function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(t,n,e){o.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(n,t){if(1&t&&(n=o(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var a in n)o.d(e,a,function(t){return n[t]}.bind(null,a));return e},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="/",o(o.s="lmpM")}({"P+vy":function(t,n){n.run=function(t,n,s){var l,d,y,o,u={title:"",summary:"",fundName:"",pName:"",startTime:"",launch_time:"",implement_res:"",exe_plan:"",proj_budget:"",exe_month_unit:"月",count:{finance:0,process:0,exe_month:0,online_day:0,process_year:0,process_month:0},pid:0},p=!1,a=0,i={},f=!1,m=0,e=function(t){if(!p){g(t.data);var n=s({td:u,money:m});if($("#wrap_calm").length||$("body").append('<div id="wrap_calm"></div>'),$("#wrap_calm").html(n),p=!0,!f){var e=document.documentElement.clientWidth||window.innerWidth,a=document.documentElement.clientHeight||window.innerHeight,o=Math.floor(.9*Math.max(e,a))-$(".j-paycalm-head").height()-$(".j-paycalm-foot").height();$(".j-paycalm-body").css("max-height",o+"px"),$(".j-close-paycalm").on("click",function(){d&&GY.is_fun(d)?d(t.data):GY.Busi.pay.paySubmit(t.data),$(".j-paycalm").removeClass("show");try{GY.Sys.mta.click({t:"clam_donate",p:{close:"true"}})}catch(t){}}),$("#btn_calm_close").on("click",function(){$(".j-paycalm").removeClass("show");try{GY.Sys.mta.click({t:"clam_donate",p:{closedother:"true"}})}catch(t){}}),$("#btn_url_ytc").click(function(){try{GY.Sys.mta.click({t:"clam_donate",p:{yuntucao:"true"}})}catch(t){}})}var i=t.data||{};+i.parent_id&&function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).parentId,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=n.onSuccess,a=n.onFail,o=n.onError;if(!t)return console.log("缺少参数 parentId");if(l&&l.id==t)return"function"==typeof e&&e(l);function i(){GY.Sys.ajax({url:"".concat("https://ssl.gongyi.qq.com","/cgi-bin/ProjInfoQuery.fcgi"),data:{id:t,type:"proj"},dataType:"json",success:function(t){0==t.code?(l=t.msg,"function"==typeof e&&e(t.msg)):"function"==typeof a&&a(t)},error:function(){"function"==typeof o&&o()}})}GY.Sys.ajax({url:"".concat("//scdn.gongyi.qq.com","/json_data/data_detail/").concat(t%100,"/detail.").concat(t,".js"),jsonpCallback:"_cb_fn_proj_".concat(t),success:function(t){if(0!=t.code)return i();l=t,"function"==typeof e&&e(t)},error:i})}({parentId:i.parent_id},{onSuccess:function(t){var n=t&&t.base&&t.base.pName;$("#exe").text(n)}})}f||setTimeout(function(){$(".j-paycalm").addClass("show")},100);var c=$("#btn_calm_cb");c.data("bind")||c.bind("click",function(){d&&GY.is_fun(d)?d(t.data):GY.Busi.pay.paySubmit(t.data),$(".j-paycalm").removeClass("show");try{GY.Sys.mta.click({t:"clam_donate",p:{goon:"true"}})}catch(t){}}).data("bind",!0);var r=$("#btn_calm_close");!r.data("bind")&&y&&GY.is_fun(y)&&r.bind("click",function(){y(t.data);try{GY.Sys.mta.click({t:"clam_donate",p:{dother:"true"}})}catch(t){}}).data("bind",!0)},c=function(n){if(i[a])return n.data=i[a],void(n.cb&&GY.is_fun(n.cb)&&n.cb(n));var t={id:a,type:"proj_base_v3"},e=__CONF__.cgiUrl1+"/cgi-bin/ProjInfoQuery.fcgi";GY.Sys.ajax({url:e,data:t,success:function(t){0==t.code?(n.data=t.msg.base,i[a]=t.msg.base,o=t.time,n.cb&&GY.is_fun(n.cb)&&n.cb(n)):n.fail&&GY.is_fun(n.fail)&&n.fail(n)},error:function(){n.fail&&GY.is_fun(n.fail)&&n.fail(n)}})},g=function(t){t&&(u=$.extend(u,t)),+t.parent_id&&(u.pName=""),o=o||GY.Util.time.formatDate(new Date),isNaN(o)||(o=GY.Util.time.unixToDate(o,"yyyy-MM-dd"));var n=parseInt(GY.Util.time.formatDate(o,"yyyy")),e=parseInt(GY.Util.time.formatDate(o,"M"));u.count.process_year=e<=6?n-2:n-1,console.log("_opTime",o);var a=GY.Util.time.diffDate(u.startTime,o,"d");u.is_d_day=a<180?"lt180":180<=a&&a<365?"lt365":"gt365",console.log("is_d_day",a,u.is_d_day),u.launch_time&&(u.count.exe_month=GY.Util.time.diffDate(u.launch_time,o,"M"),12<=u.count.exe_month&&(u.count.exe_month=(u.count.exe_month/12).toFixed(1),u.exe_month_unit="年")),u.count.online_day=a,console.log("exe_month",u.launch_time,u.count.exe_month),console.log("online_day",a)};t.extend(n,{isPage:function(t){f=t||!1},wPay:function(t){t&&t.pid?(t.money&&(m=t.money),a!=t.pid&&(p=!1),u.pid=a,t.success&&(d=t.success),t.dother&&(y=t.dother),a=t.pid,t.is_data||p?(t.op_time&&(o=t.op_time),e(t)):c($.extend({},t,{cb:e}))):console.error("pid error!")}})}},UeRr:function(t,n,e){},fweh:function(t,n){t.exports=GY},hZ9A:function(t,n,e){},kqlW:function(t,n,e){},lmpM:function(t,n,e){"use strict";e.r(n);e("kqlW"),e("o1g4"),e("UeRr");var a={loading:function(t){!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=document.getElementById("weui_dialog"),e={msg:t.msg||"加载中...",isText:t.isText||0,mask:t.mask||0};n&&null!=n||((n=document.createElement("div")).id="weui_dialog",document.body.appendChild(n)),n.innerHTML=function(t){return'\n<div class="weui_loading_toast">\n  <div class="'.concat(1==t.mask?"weui_mask":"weui_mask_transparent",'"></div>\n  <div class="weui_toast">\n    ').concat(t.isText&&1==t.isText?"":'\n    <div class="weui_loading">\n      <div class="weui_loading_leaf weui_loading_leaf_0"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_1"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_2"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_3"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_4"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_5"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_6"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_7"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_8"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_9"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_10"></div>\n      <div class="weui_loading_leaf weui_loading_leaf_11"></div>\n    </div>\n    ','\n    <p class="weui_toast_content">').concat(t.msg,"</p>\n  </div>\n</div>\n")}(e),n.setAttribute("style","display:block")}(t)},hideLoading:function(){var t=document.getElementById("weui_dialog");t&&null!=t&&t.setAttribute("style","display:none")},showToast:function(t){!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=document.getElementById("weui_dialog"),e={msg:t.msg||"提交中"};n&&null!=n||((n=document.createElement("div")).id="weui_dialog",document.body.appendChild(n)),n.innerHTML=function(t){return'\n<div class="weui_mask_transparent"></div>\n<div class="weui_toast">\n    <i class="weui_icon_toast"></i>\n    <p class="weui_toast_content">'.concat(t.msg,"</p>\n</div>\n")}(e),n.setAttribute("style","display:block"),setTimeout(function(){n.setAttribute("style","display:none"),t.callback&&"function"==typeof t.callback&&t.callback()},t.timeout||2e3)}(t)},dialog:function(t){!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=document.getElementById("weui_dialog"),e={title:t.title||"温馨提示",msg:t.msg||"系统繁忙，请稍后重试",btnText:t.btnText||"确定"};n&&null!=n||((n=document.createElement("div")).id="weui_dialog",document.body.appendChild(n)),n.innerHTML=function(t){return'\n  <div class="weui_mask"></div>\n  <div class="weui_dialog">\n    <div class="weui_dialog_hd"><strong class="weui_dialog_title">'.concat(t.title,'</strong></div>\n    <div class="weui_dialog_bd">').concat(t.msg,'</div>\n    <div class="weui_dialog_ft">\n      <a href="javascript:;" class="weui_btn_dialog primary" id="dialog_btn">').concat(t.btnText,"</a>\n    </div>\n  </div>\n")}(e),n.setAttribute("style","display:block"),document.getElementById("dialog_btn").onclick=function(){n.setAttribute("style","display:none"),t.callback&&"function"==typeof t.callback&&t.callback()}}(t)},confirm:function(t){!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=document.getElementById("weui_dialog"),e={title:t.title||"温馨提示",msg:t.msg||"系统繁忙，请稍后再试",stitle:t.stitle||"确定",ctitle:t.ctitle||"取消"};n&&null!=n||((n=document.createElement("div")).id="weui_dialog",n.setAttribute("class","weui_dialog_confirm"),document.body.appendChild(n)),n.innerHTML=function(t){return'\n  <div class="weui_mask"></div>\n  <div class="weui_dialog">\n    <div class="weui_dialog_hd"><strong class="weui_dialog_title">'.concat(t.title,'</strong></div>\n    <div class="weui_dialog_bd">').concat(t.msg,'</div>\n    <div class="weui_dialog_ft">\n      <a href="javascript:;" class="weui_btn_dialog default" id="btn_cancel">').concat(t.ctitle,'</a>\n      <a href="javascript:;" class="weui_btn_dialog primary" id="btn_sure">').concat(t.stitle,"</a>\n    </div>\n  </div>\n")}(e),n.setAttribute("style","display:block");var a=document.getElementById("btn_sure"),o=document.getElementById("btn_cancel");document.body.setAttribute("style","position:fixed;"),a.onclick=function(){document.body.removeAttribute("style"),n.setAttribute("style","display:none"),t.sure&&"function"==typeof t.sure&&t.sure()},o.onclick=function(){document.body.removeAttribute("style"),n.setAttribute("style","display:none"),t.cancel&&"function"==typeof t.cancel&&t.cancel()}}(t)}};!function(t){var e=a.confirm;Object.assign(a,{confirm:function(t){var n=0<arguments.length&&void 0!==t?t:{};e(Object.assign(n,{sure:n.sure||n.callback}))}});var n=Object.assign({},t.wd,{dialog:a});Object.assign(t,{wd:n})}(GY);e("hZ9A");var o=e("P+vy");Object(o.run)(GY,"wd.calm",function(t){var n=t.td,e='\n    <svg style="position: absolute; width: 0; height: 0; visibility: hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <symbol viewBox="0 0 48 48" id="paycalm-icon-ok" fill-rule="evenodd">\n        <g>\n          <path d="M24,43C13.5,43,5,34.5,5,24S13.5,5,24,5s19,8.5,19,19S34.5,43,24,43z M24,39c8.3,0,15-6.7,15-15S32.3,9,24,9S9,15.7,9,24S15.7,39,24,39z"/>\n          <path d="M21.9,25.5l8.5-8.5l2.8,2.8l-8.5,8.5l-2.8,2.8l-7.1-7.1l2.8-2.8L21.9,25.5z"/>\n        </g>\n      </symbol>\n      <symbol viewBox="0 0 48 48" id="paycalm-icon-warn" fill-rule="evenodd">\n        <g>\n          <path d="M24,43C13.5,43,5,34.5,5,24S13.5,5,24,5s19,8.5,19,19S34.5,43,24,43z M24,39c8.3,0,15-6.7,15-15S32.3,9,24,9S9,15.7,9,24S15.7,39,24,39z"/>\n          <path d="M22,15h4v12h-4V15z M22,30h4v4h-4V30z"/>\n        </g>\n      </symbol>\n      <symbol viewBox="0 0 48 48" id="paycalm-icon-neutral" fill-rule="evenodd">\n        <g>\n          <path d="M24,43C13.5,43,5,34.5,5,24S13.5,5,24,5s19,8.5,19,19S34.5,43,24,43z M24,39c8.3,0,15-6.7,15-15S32.3,9,24,9S9,15.7,9,24S15.7,39,24,39z"/>\n          <path d="M26,22h6v4h-6h-4V12h4V22z"/>\n        </g>\n      </symbol>\n      <symbol viewBox="0 0 48 48" id="paycalm-icon-close" fill-rule="evenodd">\n        <polygon points="36.7,14.1 33.9,11.3 24,21.2 14.1,11.3 11.3,14.1 21.2,24 11.3,33.9 14.1,36.7 24,26.8 33.9,36.7 36.7,33.9 26.8,24 "/>\n      </symbol>\n      <symbol viewBox="0 0 48 48" id="paycalm-icon-ques" fill-rule="evenodd">\n        <g>\n          <path id="Oval" d="M24,44C13,44,4,35,4,24S13,4,24,4s20,9,20,20S35,44,24,44z M24,40c8.8,0,16-7.2,16-16S32.8,8,24,8S8,15.2,8,24S15.2,40,24,40z"/>\n          <path d="M26.2,29h-4.1c0.2-1.7,1-3.2,2.3-4.3l2.4-2.5c0.8-0.6,1.2-1.5,1.2-2.7c0-2.1-1.8-3.8-4-3.8s-4,1.7-4,3.8h-4c0-4.2,3.6-7.6,8-7.6s8,3.4,8,7.6c0,1.7-0.8,3.2-1.8,4.4l-1.8,1.7C27.2,26.6,26.5,27.5,26.2,29z"/>\n          <rect x="22" y="32" width="4" height="4"/>\n        </g>\n      </symbol>\n      <symbol viewBox="0 0 266.5 243" id="paycalm-icon-logo" fill-rule="evenodd">\n        <path d="M108,38.4c11.1,6.7,19.3,17.4,22.3,30c4.5-11.6,12.3-23.1,25.5-32.8c17.6-13,32.3-16.9,45.2-17.3c-11.1-9.1-29.1-13-43.4-15.6C137.3,6.4,121.4,16.1,108,38.4 M123.6,61.8c-17.7-32.5-63.3-47.7-96-25.2c-32.5,22.3-34.7,62-17.4,92.8C27.4,160.2,72,183,87.3,184.3c0,0-6-6.4-9.3-13c-3.3-6.7-5.9-14.7-5.9-14.7c-19.7-8.3-30.1-22.3-35.3-43.9c-5.6-23.2,6-52.6,30-57.4c22.9-4.6,44.4,9.3,48.8,29.2c2.1,9.3,2.4,12.5,1.2,19.2c3.1,1.3,5.9,1.8,11.8,5.4C132.6,94.6,133.1,79.1,123.6,61.8 M109.1,119.1l-4.8,8c-0.8,1.3-2.4,1.8-3.5,1.2c-1.2-0.7-1.5-2.3-0.7-3.6l4.8-8c0.8-1.3,2.4-1.8,3.5-1.2C109.5,116.2,109.9,117.8,109.1,119.1M140.9,126.1c5.6,9.5-1.4,23.3-14,23.5c-12.8,0.1-34.5-21.4-34.5-21.4l13.8-21.1C106.3,107.1,135.2,116.5,140.9,126.1zM165.9-0.3c40.9-4.6,76.6,12.4,92.4,44.9c13.5,27.8,10.8,71-27.8,109.8c-38.9,39.2-58.7,57.7-78.8,87.9c-3.5-9.6-10.1-11.8-12.9-19.5c-2.8-7.7-0.2-13.9-1.1-18.6c-0.9-4.6-5.4-8.9-9.2-9.9c31.5-45.1,92.3-66.2,99.3-122.5C234.3,20.3,197.9,5.1,165.9-0.3z"/>\n      </symbol>\n    </svg>\n  \n    <div class="paycalm j-paycalm">\n      <div class="paycalm-mask"></div>\n      <div class="paycalm-dialog">\n        <div class="paycalm-head j-paycalm-head">\n          <svg class="paycalm-head-logo">\n            <use fill="#FFFFFF" xlink:href="#paycalm-icon-logo"></use>\n          </svg>\n          <h2 class="paycalm-head-title">腾讯公益透明度提示</h2>\n          <div class="paycalm-head-desc">\n            <span>腾讯公益致力于打造透明理性的公益平台</span>\n          </div>\n          <div class="paycalm-close j-close-paycalm">\n            <svg class="paycalm-close-icon">\n              <use fill="#FFFFFF" xlink:href="#paycalm-icon-close"></use>\n            </svg>\n          </div>\n        </div>\n        <div class="paycalm-body j-paycalm-body">\n          <div class="paycalm-use">善款将捐赠给【'.concat(n.title,'】</div>\n          <div class="paycalm-sepTitle"></div>\n          <div>\n            <table class="paycalm-table">\n              <tr>\n                <td class="paycalm-table-title">善款接收：</td>\n                <td>').concat(n.fundName,'</td>\n              </tr>\n              <tr>\n                <td class="paycalm-table-title">项目执行：</td>\n                <td id="exe">').concat(n.pName,'</td>\n              </tr>\n            </table>\n          </div>\n          <div>\n            <ul class="paycalm-keyinfo-list">\n  ');return"lt365"==n.is_d_day?e+='\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.count.exe_month?"#paycalm-icon-ok":"#paycalm-icon-neutral",'"></use></svg>\n                  <span>').concat(0<n.count.exe_month?"项目已执行 ".concat(n.count.exe_month," ").concat(n.exe_month_unit):0<n.count.online_day?"项目已上线筹款".concat(n.count.online_day,"天"):"","</span>\n                </li>\n                ").concat(0<n.count.exe_month&&n.implement_res?'\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="#paycalm-icon-ok"></use></svg>\n                  <span>'.concat(n.implement_res,"</span>\n                </li>"):"","\n                ").concat(1!=n.proj_type?'\n                \x3c!-- 一对一项目没有执行预算, 隐藏 --\x3e\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.proj_budget?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(n.proj_budget?"已提交善款执行预算":"项目尚未提交执行预算","</span>\n                </li>\n                "):"","\n                ").concat(1!=n.proj_type?'\n                \x3c!-- 一对一项目没有执行计划, 隐藏 --\x3e\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.exe_plan?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(n.exe_plan?"已提交项目执行计划":"项目尚未提交执行计划","</span>\n                </li>\n                "):"",'\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="').concat(n.count.process?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(0<n.count.process?"3个月内进展反馈共".concat(n.count.process,"次"):"近3个月项目尚未公布进展反馈","</span>\n                </li>\n    "):"lt180"==n.is_d_day?e+="\n                ".concat(0<n.count.exe_month||0<n.count.online_day?'\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.count.exe_month?"#paycalm-icon-ok":"#paycalm-icon-neutral",'"></use></svg>\n                  <span>').concat(0<n.count.exe_month?"项目已执行 ".concat(n.count.exe_month," ").concat(n.exe_month_unit):0<n.count.online_day?"项目已上线筹款".concat(n.count.online_day,"天"):"","</span>\n                </li>\n                "):"","\n                ").concat(1!=n.proj_type?'\n                \x3c!-- 一对一项目没有执行预算, 隐藏 --\x3e\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.proj_budget?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(n.proj_budget?"已提交善款执行预算":"项目尚未提交执行预算","</span>\n                </li>\n                "):"","\n                ").concat(1!=n.proj_type?'\n                \x3c!-- 一对一项目没有执行计划, 隐藏 --\x3e\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.exe_plan?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(n.exe_plan?"已提交项目执行计划":"项目尚未提交执行计划","</span>\n                </li>\n                "):"","\n                ").concat(!+n.parent_id||0<n.count.process?'\n                \x3c!-- 母项目，或者有进展的子计划才显示 --\x3e\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(n.count.process?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(0<n.count.process?"3个月内进展反馈共".concat(n.count.process,"次"):"未进入执行披露期","</span>\n                </li>\n                "):"","\n    "):"gt365"==n.is_d_day&&(e+='\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="'.concat(0<n.count.exe_month?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(0<n.count.exe_month?"项目已执行 ".concat(n.count.exe_month," ").concat(n.exe_month_unit):"项目尚未披露执行时长","</span>\n                </li>\n                ").concat(n.implement_res?'\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="#paycalm-icon-ok"></use></svg>\n                  <span>'.concat(n.implement_res,"</span>\n                </li>"):"",'\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="').concat(n.count.process?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(0<n.count.process?"3个月内进展反馈共".concat(n.count.process,"次"):"近3个月项目尚未公布进展反馈",'</span>\n                </li>\n                <li class="paycalm-keyinfo">\n                  <svg class="paycalm-keyinfo-ico"><use fill="#A0A8BD" xlink:href="').concat(n.count.finance?"#paycalm-icon-ok":"#paycalm-icon-warn",'"></use></svg>\n                  <span>').concat(0<n.count.finance?"".concat(n.count.process_year,"年至今共进行").concat(n.count.finance,"次财务披露"):"".concat(n.count.process_year,"至今未进行财务披露"),"</span>\n                </li>\n    ")),e+='\n              </ul>\n            </div>\n          </div>\n          <div class="paycalm-footbar j-paycalm-foot">\n            <div class="paycalm-footbar-item"><a href="javascript:;" id="btn_calm_close" class="paycalm-footbar-btn">了解更多项目信息</a></div>\n            <div class="paycalm-footbar-item"><a href="javascript:;" id="btn_calm_cb" class="paycalm-footbar-btn paycalm-footbar-btn-ok">我已知情，继续捐赠</a></div>\n          </div>\n        </div>\n      </div>\n  '});var i=e("fweh"),c=e.n(i);c.a.Util,c.a.Busi.authorize;function r(t,n){var e=0<arguments.length&&void 0!==t?t:"",a=1<arguments.length?n:void 0;try{return decodeURIComponent(e)}catch(t){return a||e}}function s(t,n){var e=(1<arguments.length&&void 0!==n?n:{}).size;if(!t)return"";var a=function(t,n){return t?(n||location.protocol)+(""+t).replace(/^https?:/,""):""}(r(t));return null==e?a:/[?&]s=\d*(&|$)/.test(a)?a.replace(/([?&])s=\d*(&|$)/,"$1s=".concat(e,"$2")):a.replace(/\/\d*$/,"")+"/".concat(e)}var l={find:function(){Array.prototype.find=Array.prototype.find||function(t){return this.filter(t)[0]}}},d=[1e3,2e3,3e3,880,666,168,1690,2880,3660,5200,6660,8880,9990],y=[1e3,2e3,3e3,880,666,168,1690,2880,3660,5200,6660,8880,9990],x=1188,u=[{month:x,text:"不限期"},{month:6,text:"6个月"},{month:12,text:"1年"},{month:24,text:"2年"},{month:36,text:"3年"}],p=[2e3,5e3,1e4],f=[1e3,5e3,1e4],m=[1e3,3e3,1e4];function g(t){if(t){var n=new Date;return{id:t.item_id,thumbnail:s(t.goods_pics&&(t.goods_pics[1]||t.goods_pics[0]),{size:0}),pic:s(t.goods_pics&&t.goods_pics[0],{size:0}),name:r(t.name),stock:+t.quantity||0,limit:+t.max_receive||1,priceInFen:+t.min_cost||0,priceInYuan:v(t.min_cost),setMoney:t.setMoney,isActive:n>=new Date((t.start_time||"").replace(/-/g,"/"))&&n<=new Date((t.end_time||"").replace(/-/g,"/"))}}}function h(t){if(t&&t.length)return t.map(g).filter(function(t){return 0<t.stock&&t.isActive}).sort(function(t,n){return t.priceInFen-n.priceInFen})}function _(t){if(t&&t.length)return t.map(function(t){return{price:t.min_cost,priceInYuan:v(t.min_cost),pic:s(t.goods_pics&&t.goods_pics[0],{size:200}),sponsor:r(t.sponsor),goods:r(t.name),limit:t.max_receive<1e7&&0<t.max_receive?t.max_receive:0,code:t.item_id,setMoney:t.setMoney}}).sort(function(t,n){return t.price-n.price})}function v(t){return+(t/100).toFixed(2)}function b(t){if(t&&t.length)return t[Math.floor(Math.random()*t.length)]}function w(t){var n=(0<arguments.length&&void 0!==t?t:{}).ext_donate;if(!n)return null;var e=n.qunt,a=n.nm,o=n.prc;return e&&a&&o?{price:+o,unit:"".concat(e).concat(a),quant:e,item:a}:null}function k(t,n){return n&&n.price?Math.floor(t/n.price||0):0}function j(t,n,e){var a=2<arguments.length&&void 0!==e?e:{};if(a.forceMoney)return"".concat(v(t)).concat(a.sep||"","元");var o=k(t,n);return 0<o?"".concat(o).concat(a.sep||"").concat(a.quantOnly?n.quant:n.unit):"".concat(v(t)).concat(a.sep||"","元")}function D(t){if(isNaN(t)||t<=0)return"";if(x<=t)return"不限期";var n="共",e=Math.floor(t/12);e&&(n+="".concat(e,"年"));var a=t-12*e;return a&&(n+="".concat(a,"个月")),n}var L=function(t){return isNaN(t)?(GY.wd.dialog.dialog({msg:"请输入格式正确的数字"}),!1):t<100?(GY.wd.dialog.dialog({msg:"月捐金额不能低于".concat(v(100),"元。")}),!1):!(5e4<t)||(GY.wd.dialog.dialog({msg:"单个项目按月定额捐助最高限额为".concat(v(5e4),"元。")}),!1)},S=function(t){if(!+t)return GY.wd.dialog.dialog({msg:"请填写正确金额"}),!1;return!!/^([1-9]\d{0,5}|0)(\.\d{1,2})?$/.test(t)||(GY.wd.dialog.dialog({msg:"请填写正确金额"}),!1)},M=function(t){return isNaN(t)?(GY.wd.dialog.dialog({msg:"请输入格式正确的数字"}),!1):!(t<1)||(GY.wd.dialog.dialog({msg:"请填写正确金额"}),!1)},O=function(t){return isNaN(t)?(GY.wd.dialog.dialog({msg:"请输入格式正确的数字"}),!1):!(t<1)||(GY.wd.dialog.dialog({msg:"请填写正确月数"}),!1)};function G(t){if(t&&0<t.lastmn){var n=t.aid,e=t.company_sn,a=t.logo,o=+(t.enlarge_times/10).toFixed(1)||0;return{aid:n,entName:r(e||"爱心企业"),entLogo:s(a,{size:0}),times:o}}}function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Y=GY.Util,C=GY.Busi.authorize;function T(){return"wx"==GY.browser.client}function E(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function I(a){var t=Object.keys(a).reduce(function(t,n){var e=a[n];return t+n+": "+(e=e&&"object"===P(e)?JSON.stringify(e):e)+"; "},"");t=t.slice(0,-2),console.log(t),GY.Sys.rpt.info(t,!0)}function B(e){return e?Object.keys(e).reduce(function(t,n){return null!=e[n]&&(t[n]=e[n]),t},{}):{}}function U(a,o){if(o=o||{},!(a=a||{}).url)throw new Error("缺少参数url");var i={};Object.keys(a).forEach(function(t){["success","fail","error"].indexOf(t)<0&&(i[t]=a[t])});var t=T()?{gysts:C.encodeToken()}:{g_tk:C.encodeToken()};if(i.login)if("string"==typeof i.type&&"POST"==i.type.toUpperCase()){var n=new URL(i.url,location.origin);n.search+="&"+Y.object.toStr(t),i.url=n.href}else $.extend(i.data,t);i.success=function(t){if(!t)return I({url:i.url,par:i.data,ret:t,msg:"ret应为一个对象,但得到"+E(t)}),void("function"==typeof a.fail&&a.fail(t));var n=t[a.codeName||"code"];if(!i.login||C.ckLogin({code:n,isGetCode:0})){var e=a.success||o[0];if(a.noCheckCode)"function"==typeof e&&e(t);else switch(+n){case 0:"function"==typeof e&&e(t);break;case 110033:case 110063:"function"==typeof o[n]&&o[n](t),setTimeout(function(){GY.Sys.ajax(i)},1e3);break;default:("array"===E(a.noReport)&&a.noReport.indexOf(+n)<0||"array"!==E(a.noReport)&&a.noReport!==+n)&&I(B({label:a.label,url:a.url,par:a.data,ret:t,cookie:a.login?document.cookie:null})),"function"==typeof o[n]&&o[n](t),"function"==typeof a.fail&&a.fail(t)}}else GY.user.uid="",C.login({snsapi:i.snsapi,state:i.state})},i.error=function(t,n){I(B({label:a.label,url:a.url,par:a.data,errmsg:n})),"function"==typeof a.error&&a.error(t,n)},GY.Sys.ajax(i)}function A(t,n){var e=0<arguments.length&&void 0!==t?t:"",a=1<arguments.length?n:void 0;try{return decodeURIComponent(e)}catch(t){return a||e}}function H(t,n){if(!t||!t.length)return[];if(!n||!n.length)return t;for(var e=t.slice(0),a=0;a<n.length;a++)e[a]=n[a];return e}function N(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.onSuccess,a=n.onError,o=n.onComplete;"undefined"==typeof MtaH5?function(t,n){var e=1<arguments.length&&void 0!==n?n:{},a=e.onSuccess,o=e.onError,i=$("<script>");i.on("load",function(t){"function"==typeof a&&a(t),i.remove()}).on("error",function(t){"function"==typeof o&&o(t),i.remove()}).attr("src",t),$("body").append(i)}("//pingjs.qq.com/h5/stats.js?v2.0.2",{onSuccess:function(){"function"==typeof e&&e(),"function"==typeof o&&o()},onError:function(){"function"==typeof a&&a(),"function"==typeof o&&o()}}):("function"==typeof e&&e(),"function"==typeof o&&o())}var F="//scdn.gongyi.qq.com";function R(t,n){var e=0<arguments.length&&void 0!==t?t:{},a=e.pid,o=e.type,i=1<arguments.length&&void 0!==n?n:{},c=i.onSuccess,r=i.onFail,s=i.onError;if(!a)throw new Error("缺少参数 `pid`");GY.Busi.authorize.login({callback:function(){U({url:"/cgi-bin/gywp_WXGetPersonalMonthDonateV3",data:{oid:GY.user.uid,actid:a,op:o||"getmddetail",pg:1,pgnum:1},codeName:"ret",success:function(t){"function"==typeof c&&c(t)},fail:function(t){"function"==typeof r&&r(t)},error:function(){"function"==typeof s&&s()}})}})}function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function J(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function V(t,n){return(V=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function Q(){GY.wd.dialog.hideLoading(),GY.wd.dialog.dialog({msg:"捐款完成后您可以分享给朋友，请大家一起献爱心",btnText:"查看捐赠结果",callback:function(){GY.Busi.pay.gyCheckTradeNo(!0)}})}var X=function(t){return function(){function e(t){var n;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,n){return!n||"object"!==q(n)&&"function"!=typeof n?J(t):n}(this,W(e).call(this,t)),!t.data||!t.data.base)throw new Error("缺少参数 `data.base`");return n._success=t.success,n._error=t.error,GY.Busi.pay.isCkOrd=!1,GY.Busi.pay.payCallback=n._cbSuccessPay.bind(J(n)),GY.Busi.pay.safariCallback=Q,n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&V(t,n)}(e,t),function(t,n,e){n&&z(t.prototype,n),e&&z(t,e)}(e,[{key:"_cbSuccessPay",value:function(t){var e=this;GY.wd.dialog.hideLoading();try{sessionStorage.setItem("appPayProj",JSON.stringify(this._data.base))}catch(t){console.log("Session save faild!")}var n=GY.Util.uri.getUriPar("bid")||"",a=GY.Util.uri.getUriPar("ref_url")||"";if(n&&a&&GY.Busi.pay.domain)return function(t){var n=GY.Busi.pay.domain;t&&(t=-1!==(t=decodeURIComponent(t)).indexOf("?")?t.replace(/\?/,"?tradeno="+GY.Busi.pay.trade_no+"&"):-1!==t.indexOf("#")?t.replace(/#/i,"?tradeno="+GY.Busi.pay.trade_no+"#"):t+"?tradeno="+GY.Busi.pay.trade_no,location.href=n+t)}(a);if(0!=t.code)if("function"==typeof this._error)this._error(t);else{if(2==t.code||3==t.code)return GY.wd.dialog.dialog({msg:t.info});GY.wd.dialog.dialog({msg:t.msg,callback:function(){GY.wd.dialog.hideLoading()}})}else{try{sessionStorage._gift=t.info.transcode}catch(t){console.log("Session save faild!")}var o=t.info.transcode,i=this._tplData.comment;new Promise(function(t,n){i&&1==e._data.base.feedback_flag?(console.log("您写下爱心留言：",i),GY.Reporter.info({event:"click",name:"leave_comment"}),function(t,n){var e=t.content,a=t.tid,o=1<arguments.length&&void 0!==n?n:{},i=o.onSuccess,c=o.onFail,r=o.onError,s=o.onComplete;U({url:"/cgi-bin/gywcom_pub_proj_comment",type:"POST",data:JSON.stringify({content:e,tid:a}),dataType:"json",login:!0,success:function(t){"function"==typeof i&&i(t),"function"==typeof s&&s()},fail:function(t){"function"==typeof c&&c(t),"function"==typeof s&&s()},error:function(){"function"==typeof r&&r(),"function"==typeof s&&s()}})}({content:i,tid:o},{onSuccess:function(){console.log("您的爱心留言已成功提交")},onFail:function(t){var n=0<arguments.length&&void 0!==t?t:{};console.log("爱心留言提交失败(".concat(n.code,"):").concat(n.msg))},onError:function(){console.log("爱心留言提交失败")},onComplete:t})):t()}).then(function(){return new Promise(function(t){N({onSuccess:function(){try{MtaH5.clickStat("donate_box_1811",function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}({},e._mtaParam,"paySuccess"))}catch(t){}},onComplete:t})})}).then(function(){try{GY.AmsReport.pay(t.info.money)}catch(t){}"function"==typeof e._success?e._success(t):setTimeout(function(){location.href="/m/weixin/thanks.html?transcode=".concat(o)},500)})}}}]),e}()};function K(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function Z(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var tt=!1,nt=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=$("#pageContainer"),this._container.length||(console.warn("页面中找不到元素 `#pageContainer`, 组件将插入到 `body`"),this._container=$("body")),this._bindedData={},this._bindData()}return function(t,n,e){n&&Z(t.prototype,n),e&&Z(t,e)}(t,[{key:"hide",value:function(){this._payLayer&&this._payLayer.removeClass("show")}},{key:"_bindData",value:function(){var o=this;Object.defineProperties(this._bindedData,{money:{get:function(){return o._tplData.money},set:function(t){if(t=+t||0,o._tplData.money=t,o._payLayer.find(".j-money").text(v(t)),0<k(t,o._gyUnit)?(o._payLayer.find(".j-unit").text("".concat(j(t,o._gyUnit))),o._payLayer.find(".gy-paylayer-head-desc").show()):o._payLayer.find(".gy-paylayer-head-desc").hide(),"function"==typeof o._getMoneyDesc){var n=o._getMoneyDesc({money:t,data:o._data});o._payLayer.find(".j-moneyDesc").text(n||"")}if(o._bindedData.cogiftList){var e=o._bindedData.cogiftList;o._updateCoGiftByMoney({money:t,giftList:e})}if(o._bindedData.giftList){var a=o._bindedData.giftList;o._updateGiftByMoney({money:t,giftList:a})}o._bindedData.matchData&&o._payLayer.find(".j-match").text(Math.min(999,v(t*o._bindedData.matchData.times)))}},month:{get:function(){return o._tplData.month},set:function(t){t=+t||0,o._tplData.month=t;var n=o._monthData&&o._monthData.remaining||0;o._payLayer.find(".j-span").text(D(t+n))}},matchData:{get:function(){return o._tplData&&o._tplData.matchData},set:function(t){o._tplData&&o._payLayer&&(o._tplData.matchData=t)&&o._payLayer.find(".j-match-wrap").html(function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.money,a=n.matchData;return'\n    <div class="gy-paylayer-jbj">\n      <div class="gy-paylayer-jbj-cologo">\n        <img src="'.concat(a.entLogo,'" alt="">\n      </div>\n      <div class="gy-paylayer-jbj-m autoheight">\n        <p class="gy-paylayer-jbj-desc">').concat(a.entName,"<br>为你的爱心加").concat(a.times,'倍<span class="clr_blue">（最高 ').concat(999,' 元）</span></p>\n      </div>\n      <div class="gy-paylayer-jbj-ft">\n        <p class="fnt-dinc jbj-money"><b>+ ¥<span class="j-match">').concat(Math.min(999,v(e*a.times)),"</span></b></p>\n      </div>\n    </div>\n  ")}({money:o._tplData.money,matchData:t}))}},giftList:{get:function(){return o._tplData&&o._tplData.giftList},set:function(t){if(o._tplData&&(o._tplData.giftList=t,o._payLayer)){if(!t||!t.length)return o._payLayer.find(".j-gift-wrap").html("");var n=o._bindedData.money,e=t.find(function(t){return t.setMoney});e?(o._currentGift=e,o._eventHandlers&&o._eventHandlers.setMoneyToGiftPrice&&o._eventHandlers.setMoneyToGiftPrice()):o._updateGiftByMoney({money:n,giftList:t})}}},cogiftList:{get:function(){return o._tplData&&o._tplData.cogiftList},set:function(t){if(o._tplData&&(o._tplData.cogiftList=t,o._payLayer)){if(!t||!t.length)return o._payLayer.find(".j-cogift-wrap").html("");var n=o._bindedData.money,e=t.find(function(t){return t.setMoney});e?(o._currentCoGift=e,o._eventHandlers&&o._eventHandlers.setMoneyToCoGiftPrice&&o._eventHandlers.setMoneyToCoGiftPrice()):o._updateCoGiftByMoney({money:n,giftList:t})}}}})}},{key:"_updateGiftByMoney",value:function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.money,a=n.giftList;this._currentGift=a&&(a.find(function(t){return e<=t.priceInFen})||a.slice(-1)[0]),this._payLayer&&this._payLayer.find(".j-gift-wrap").html(this._currentGift?function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.giftData,a=n.money;return'\n    <div class="gy-paylayer-picinfo">\n      <div class="picinfo-box">\n        <div class="picinfo-hd">\n          <div class="gift-pic" style="background: center / cover url('.concat(e.pic,')"></div>\n        </div>\n        ').concat(a>=e.priceInFen?'\n            <div class="picinfo-m">\n              <p class="text-ellipsis"><b>可得爱心回礼：'.concat(e.name,'</b></p>\n              <p class="p-desc">(库存有限，以捐款结果页为准）</p>\n            </div>\n          '):'\n            <div class="picinfo-m">\n              <p><b>捐 ¥'.concat(e.priceInYuan,' 可得爱心回礼：</b></p>\n              <p class="text-ellipsis"><b>').concat(e.name,"</b></p>\n            </div>\n          "),"\n        ").concat(a>=e.priceInFen?"":'\n            <div class="picinfo-ft">\n              <div class="btn-redborder j-gift-donate-btn"><b>捐¥'.concat(e.priceInYuan,"</b></div>\n            </div>\n          "),"\n      </div>\n    </div>\n  ")}({money:e,giftData:this._currentGift}):"")}},{key:"_updateCoGiftByMoney",value:function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.money,a=n.giftList;this._currentCoGift=a&&(a.find(function(t){return e<=t.price})||a.slice(-1)[0]),this._payLayer&&this._payLayer.find(".j-cogift-wrap").html(this._currentCoGift?function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.giftData,a=n.money;return'\n    <div class="gy-paylayer-picinfo">\n      <div class="picinfo-box">\n        <div class="picinfo-hd">\n          <img src="'.concat(e.pic,'" alt="">\n        </div>\n        ').concat(a>=e.price?'\n            <div class="picinfo-m">\n              <p style="font-size:.14rem"><b>可得'.concat(e.sponsor,"提供的").concat(e.goods,'<span class="clr_dft">1</span>张</b></p>\n              ').concat(e.limit?'<p class="p-desc">(每人限领 '.concat(e.limit," 次，每次 1 张）</p>"):"","\n            </div>\n          "):'\n            <div class="picinfo-m">\n              <p><b>捐 ¥'.concat(e.priceInYuan," 可得：").concat(e.sponsor,"提供的").concat(e.goods," 1 张</b></p>\n              ").concat(e.limit?"<p>(每人限领 ".concat(e.limit," 次，每次 1 张)</p>"):"",'\n            </div>\n            <div class="picinfo-ft">\n              <a href="javascript:;" class="btn-redborder j-cogift-donate-btn"><b>捐¥').concat(e.priceInYuan,"</b></a>\n            </div>\n          "),"\n      </div>\n    </div>\n  ")}({money:e,giftData:this._currentCoGift}):"")}},{key:"_attachEvent",value:function(){var e=this,n=e._payLayer.find(".gy-paylayer-mbtn-input");function a(t,n){(n&&n.length?n:e._payLayer).find(".gy-paylayer-mbtn").removeClass("current"),(t.hasClass("gy-paylayer-mbtn")?t:t.closest(".gy-paylayer-mbtn")).addClass("current")}e._eventHandlers={closePayLayer:function(){e._payLayer.removeClass("show"),"function"==typeof e._close&&e._close.call(null)},chooseAmount:function(){if(e._payLayer.hasClass("show")){var t=$(this);a(t,e._payLayer.find(".gy-paylayer-main")),n.val(""),t.find(".gy-paylayer-mbtn-input").length?(n.focus(),e._bindedData.money=""):e._bindedData.money=t.data("money")}},chooseTime:function(){if(e._payLayer.hasClass("show")){var t=$(this);a(t,e._payLayer.find(".gy-paylayer-time")),e._bindedData.month=t.data("month")}},pickRandom:function(){if(e._payLayer.hasClass("show")){var t=e._pickRandomMoney();n.val(v(t)),a(n,e._payLayer.find(".gy-paylayer-main")),e._bindedData.money=t}},inputAmount:function(){if(e._payLayer.hasClass("show")){var t=$(this),n=t.val();/^(\d|[1-9]\d{1,5})(\.\d{0,2})?$/.test(n)||t.val(n.slice(0,-1)),e._bindedData.money=function(t){return+(100*t).toFixed(0)}(t.val())}},setMoneyToGiftPrice:function(){if(e._bindedData.giftList){var t=e._currentGift;t&&(a(n,e._payLayer.find(".gy-paylayer-main")),n.val(t.priceInYuan),e._bindedData.money=t.priceInFen)}},setMoneyToCoGiftPrice:function(){if(e._bindedData.cogiftList){var t=e._currentCoGift;t&&(a(n,e._payLayer.find(".gy-paylayer-main")),n.val(t.priceInYuan),e._bindedData.money=t.price)}},changeAgree:function(){e._payLayer.hasClass("show")&&(e._tplData.agree=$(this).prop("checked"))},changeAnonymous:function(){e._payLayer.hasClass("show")&&(e._tplData.anonymous=$(this).prop("checked"),console.log("anonymous",e._tplData.anonymous),N({onSuccess:function(){try{MtaH5.clickStat("donate_box_1811",K({},e._mtaParam,"anonymous"))}catch(t){}}}))},mta:function(){var t=this;N({onSuccess:function(){try{MtaH5.clickStat("donate_box_1811",K({},e._mtaParam,$(t).data("mtav")))}catch(t){}}})},resetPosition:function(){setTimeout(function(){var t=document.documentElement.scrollTop||document.body.scrollTop||0;window.scrollTo(0,Math.max(t-1,0))},100)},comment:function(){if(!tt){var t=GY.Util.string.getSubCString($(this).val().trim().replace(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g,""),0,40);$(this).val(t),e._tplData.comment=t}}},e._container.on("click","#".concat(e._domId," .gy-paylayer-close"),e._eventHandlers.closePayLayer).on("click","#".concat(e._domId," .j-choose-amount .gy-paylayer-mbtn"),e._eventHandlers.chooseAmount).on("click","#".concat(e._domId," .j-choose-time .gy-paylayer-mbtn"),e._eventHandlers.chooseTime).on("click","#".concat(e._domId," .gy-paylayer-random"),e._eventHandlers.pickRandom).on("click","#".concat(e._domId," .j-cogift-donate-btn"),e._eventHandlers.setMoneyToCoGiftPrice).on("click","#".concat(e._domId," .j-gift-donate-btn"),function(){e._eventHandlers.setMoneyToGiftPrice(),function(){var t;try{t=JSON.parse(window.localStorage&&window.localStorage["_abtest_".concat(location.pathname)]).id}catch(t){console.log("donate_box get abtest version error",t)}GY.Reporter.info({event:"click",name:"donatebox_axhl",value:"¥".concat(e._currentGift.priceInYuan),version:t})}()}).on("click","#".concat(e._domId," [data-mtav]"),e._eventHandlers.mta),n.on("input",e._eventHandlers.inputAmount),e._payLayer.find(".j-agreement input").on("change",e._eventHandlers.changeAgree),e._payLayer.find(".j-anonymous input").on("change",e._eventHandlers.changeAnonymous),e._payLayer.find(".j-comment").on("compositionstart",function(){tt=!0}).on("compositionend",function(){tt=!1,e._eventHandlers.comment.call(this)}).on("input",e._eventHandlers.comment).on("input propertychange compositionend",function(){$(this).removeAttr("style").height(this.scrollHeight)}),e._payLayer.find("input, select, textarea").on("blur",e._eventHandlers.resetPosition)}}]),t}();function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function at(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ot(t,n){return!n||"object"!==et(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):n}function it(t,n,e){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=ct(t)););return t}(t,n);if(a){var o=Object.getOwnPropertyDescriptor(a,n);return o.get?o.get.call(e):o.value}})(t,n,e||t)}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t,n){return(rt=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function st(t){return t&&t.length?t.filter(function(t){return 0<t}):[]}var lt=function(){function e(t){var n;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n=ot(this,ct(e).call(this,t)),!t.data||!t.data.base)throw new Error("缺少参数 `data.base`");return n._dother=t.dother,n._close=t.close,n._data=t.data,n._matchData=t.matchData,n._giftList=t.giftData,n._cogiftList=t.cogiftData,n._yqj=t.yqj,n._limit=t.limit,n._validators=t.validators,n._getMoneyDesc=t.getMoneyDesc,n._par=t.par,n._domId=t.wdKey,n._mtaParam=n._yqj?n._limit?"yqjlimit":n._gyUnit?"uyqj":"yqj":n._gyUnit?"uonce":"once",n._customPayMethod=t.customPayMethod,n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&rt(t,n)}(e,X(nt)),function(t,n,e){n&&at(t.prototype,n),e&&at(t,e)}(e,[{key:"_showPay",value:function(){this._updateUI(),this._payLayer.addClass("show")}},{key:"show",value:function(t){var n=this,e=(0<arguments.length&&void 0!==t?t:{}).calm;if(this._tplData=this._tplData||this._mapToTplData(),this._payLayer=$("#".concat(this._domId)),!this._payLayer.length){var a=function(t){var n=t.projPic,e=t.aided,a=t.options,o=t.money,i=t.agree,c=t.anonymous,r=t.gyUnit,s=t.domId,l=t.limit,d=(t.matchData,t.enableComment),y=a.every(function(t){return t.money!=o}),u=k(o,r);return'\n    <div class="gy-paylayer" id="'.concat(s,'">\n      <div class="gy-paylayer-mask"></div>\n      <div class="gy-paylayer-box">\n        <div class="gy-paylayer-head">\n          <div class="gy-paylayer-head-cover">\n            <img src="').concat(n,'" alt=""/>\n          </div>\n          <div class="gy-paylayer-head-m">\n            <p class="gy-paylayer-head-title"><b>为').concat(e,'捐出</b></p>\n            <p class="gy-paylayer-head-desc j-unit">').concat(0<u?"".concat(u).concat(r.unit):"",'</p>\n            <p class="gy-paylayer-head-amount">\n              <b class="gy-paylayer-head-amount-unit">￥</b><span class="gy-paylayer-dinc j-money">').concat(v(o),'</span>\n              <span class="j-moneyDesc"></span>\n            </p>\n          </div>\n        </div>\n\n        <div class="j-match-wrap"></div>\n\n        <div class="gy-paylayer-main">\n        ').concat(l?'\n            <div class="gy-paylayer-cell j-choose-amount">\n              <div class="gy-paylayer-cell-m gy-paylayer-mbtn current" data-money="'.concat(o,'">限定 ').concat(v(o)," 元</div>\n            </div>\n          "):'\n            <div class="gy-paylayer-cell j-choose-amount">\n            '.concat(a.map(function(t,n){return'\n                <div class="gy-paylayer-cell-m gy-paylayer-mbtn '.concat(t.money==o?"current":"",'" data-money="').concat(t.money,'" data-mtav="amount').concat(n+1,'">').concat(t.text,"</div>\n              ")}).join(""),'\n            </div>\n            <div class="gy-paylayer-cell j-choose-amount">\n              <div class="gy-paylayer-cell-m gy-paylayer-mbtn gy-paylayer-mbtn_custom ').concat(y?"current":"",'" data-mtav="amountInput">\n                <span class="gy-paylayer-mbtn-unit">￥</span>\n                <input class="gy-paylayer-mbtn-input" type="number" pattern="[0-9.]*" placeholder="自定金额" value="').concat(y?v(o):"",'">\n              </div>\n              <div data-mtav="rand">\n                <a href="javascript:;" class="gy-paylayer-random">\n                  <svg class="gy-paylayer-icomini" viewBox="0 0 48 48" fill-rule="evenodd"><path d="M37.5196,15.4804 L34.5996,18.4004 C35.4796,20.0804 35.9996,21.9804 35.9996,24.0004 C35.9996,30.6184 30.6196,36.0004 23.9996,36.0004 L23.9996,30.0004 L15.9996,38.0004 L23.9996,46.0004 L23.9996,40.0004 C32.8396,40.0004 39.9996,32.8404 39.9996,24.0004 C39.9996,20.8604 39.0796,17.9404 37.5196,15.4804 M23.9996,12.0004 L23.9996,18.0004 L31.9996,10.0004 L23.9996,2.0004 L23.9996,8.0004 C15.1596,8.0004 7.9996,15.1604 7.9996,24.0004 C7.9996,27.1404 8.9196,30.0604 10.4796,32.5204 L13.3996,29.6004 C12.4996,27.9384 11.9996,26.0204 11.9996,24.0004 C11.9996,17.3804 17.3796,12.0004 23.9996,12.0004"></path></svg>随缘\n                </a>\n              </div>\n            </div>\n          '),"\n        </div>\n\n        ").concat(d?'\n            <div class="gy-paylayer-comment">\n              <div class="gy-paylayer-comment-title">爱心留言</div>\n              <textarea rows="1" class="gy-paylayer-comment-input j-comment" placeholder="写下你想对“'.concat(e,'”说的话吧"></textarea>\n            </div>\n          '):"",'\n\n        \x3c!-- 爱心回礼 --\x3e\n        <div class="j-gift-wrap"></div>\n        \x3c!-- 企业回馈 --\x3e\n        <div class="j-cogift-wrap cogift-wrap"></div>\n\n        <div class="gy-paylayer-checkarea">\n          <div class="gy-paylayer-cell j-agreement">\n            <div>\n              <label class="gy-paylayer-checkbox">\n                <input type="checkbox" ').concat(i?"checked":"",' />\n                <i class="gy-paylayer-checkbox-icon">\n                  <svg viewBox="0 0 38 38" class="gy-paylayer-checkbox-icon-s">\n                    <path d="M16.9,20.5l8.5-8.5l2.8,2.8l-8.5,8.5l-2.8,2.8l-7.1-7.1l2.8-2.8L16.9,20.5z"/>\n                  </svg>\n                </i>\n              </label>\n            </div>\n            <div class="gy-paylayer-cell-m">\n              <div>同意&nbsp;<a href="http://gongyi.qq.com/m/html5/about_1.htm" class="gy-paylayer-protocol">用户捐赠协议</a></div>\n            </div>\n          </div>\n          <div class="gy-paylayer-cell j-anonymous">\n            <div>\n              <label class="gy-paylayer-checkbox">\n                <input type="checkbox" ').concat(c?"checked":"",' />\n                <i class="gy-paylayer-checkbox-icon">\n                  <svg viewBox="0 0 38 38" class="gy-paylayer-checkbox-icon-s">\n                    <path d="M16.9,20.5l8.5-8.5l2.8,2.8l-8.5,8.5l-2.8,2.8l-7.1-7.1l2.8-2.8L16.9,20.5z"/>\n                  </svg>\n                </i>\n              </label>\n            </div>\n            <div class="gy-paylayer-cell-m">\n              <div>匿名捐助</div>\n            </div>\n          </div>\n        </div>\n        <div class="gy-paylayer-fbtnbar">\n          <button class="gy-paylayer-fbtn gy-paylayer-fbtn_dft j-pay" data-mtav="submit">确定</button>\n        </div>\n        <div class="gy-paylayer-close" data-mtav="close"></div>\n      </div>\n    </div>\n  ')}(this._tplData);this._container.append(a),this._payLayer=$("#".concat(this._domId)),this._attachEvent()}var o=this._data.base;e?GY.wd.calm.wPay({pid:o.id,is_data:!0,data:o,success:function(){n._showPay()},dother:"function"==typeof this._dother?this._dother:null}):this._showPay()}},{key:"update",value:function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.par,a=n.dother,o=n.validators,i=n.getMoneyDesc,c=n.giftData,r=n.cogiftData,s=n.matchData,l=n.success,d=n.error;this._par=e||this._par,this._dother=a||this._dother,this._success=l||this._success,this._error=d||this._error,this._validators=o||this._validators,this._getMoneyDesc=i||this._getMoneyDesc,this._bindedData.matchData=G(s)||this._tplData&&this._tplData.matchData,this._bindedData.giftList=h(c)||this._tplData&&this._tplData.giftList,this._bindedData.cogiftList=_(r)||this._tplData&&this._tplData.cogiftList,this._updateUI()}},{key:"_updateUI",value:function(){this._tplData&&(this._bindedData.matchData=this._tplData.matchData,this._bindedData.giftList=this._tplData.giftList,this._bindedData.cogiftList=this._tplData.cogiftList,this._bindedData.money=this._tplData.money)}},{key:"_pay",value:function(){if(function(t){var n=/(iphone)|(ipad)|(ipod)/i.test(window.navigator.userAgent),e=window.navigator.userAgent.match(/MicroMessenger\/([\d.]+)/i),a=e&&1<e.length?e[1]:-1;return n&&function(t,n){var e,a,o,i;if(t==n||-1==t)return 0;t=String(t).split("."),n=String(n).split(".");try{for(e=0,a=Math.max(t.length,n.length);e<a;e++){if((o=isFinite(t[e])&&Number(t[e])||0)<(i=isFinite(n[e])&&Number(n[e])||0))return-1;if(i<o)return 1}}catch(t){return-1}return 0}(a,t)<0}("5.3.1"))GY.wd.dialog.dialog({msg:"很抱歉，您的微信版本过低，暂不支持公益捐赠，请下载安装最新的微信版本客户端。",btnText:"马上下载",callback:function(){location.href="https://itunes.apple.com/cn/app/wei-xin/id414478124?mt=8"}});else{var t=this._tplData,n=t.agree,a=t.money,e=this._payLayer.find(".j-money").text();if(console.log("您将捐出".concat(a,"分")),!n)return GY.wd.dialog.dialog({msg:"同意并接受《用户捐赠协议》"});if(S(e)&&M(a)){if(this._validators&&this._validators.length)if(!this._validators.every(function(t,n){var e="function"==typeof t&&t(a);return e||console.log("支付金额校验不通过 (validators[".concat(n,"](").concat(a,")=").concat(e,")")),e}))return;var o=this._data.base,i=this._getPayPar(),c=o.ext_fields;if(c&&"1"==c.is_feedback_url&&v(this._tplData.money)>=parseFloat(c.feedback_condition)&&(!c.feedback_pt||"all"==c.feedback_pt||c.feedback_pt==uClient))return sessionStorage.setItem("cbSuccessPay",this._success),sessionStorage.setItem("addr_par",GY.Util.object.toString(i)),void(window.location.href="/m/weixin/address.html");"function"==typeof this._customPayMethod?this._customPayMethod(i):(GY.Busi.pay.paySubmit(i),this._payLayer.removeClass("show"),"function"==typeof this._close&&this._close.call(null))}}}},{key:"_getPayPar",value:function(){var t=this._tplData.money,n=this._data.base,e=this._payLayer.find(".j-money").text(),a={money:v(t),anon:this._tplData.anonymous?1:0,smoney:e,actid:n.id,oid:GY.user.uid,opar:{money:e}},o=GY.Util.uri.getUriPar("et"),i=GY.Util.uri.getUriPar("gt");o&&(a.et=o),i&&(a.gt=i);var c=this._bindedData.matchData;c&&c.aid&&(a.ecard=c.aid);var r=GY.Util.uri.getUriPar("pt"),s=GY.Util.uri.getUriPar("bid"),l=GY.Util.uri.getUriPar("sign");return s&&l&&"mweb"!=r&&(a.bid=s,a.sign=l,a.bt="s"),s&&"mweb"==r&&"wx"!=uClient&&GY.browser&&"qq"!=GY.browser.client&&(a.bid=s,a.tradeType="mweb",a.device="Android",a.redirect_url="https://ssl.gongyi.qq.com/m/weixin/ckmweb.html?tradeno="),$.extend(a,this._par),a}},{key:"_pickRandomMoney",value:function(){return b(d)}},{key:"_attachEvent",value:function(){if(!this._payLayer.data("init")){it(ct(e.prototype),"_attachEvent",this).call(this);var t=this;t._eventHandlers.pay=t._eventHandlers.pay||function(){t._payLayer.hasClass("show")&&t._pay()},t._container.on("click","#".concat(this._domId," .j-pay"),t._eventHandlers.pay),t._payLayer.data("init",!0)}}},{key:"_mapToTplData",value:function(){console.log("matchData",this._bindedData.matchData);var t=this._data.base,n=w(t),e=this._getMoneyOptions();return{projPic:A(t.listImg).replace(/\/\d+$/,"")+"/0",aided:A(t.ext_donate&&t.ext_donate.targ||"受助对象"),money:this._yqj&&this._limit?this._limit:e[0].money,options:e,anonymous:!1,agree:!0,gyUnit:n,domId:this._domId,limit:this._yqj&&this._limit,matchData:G(this._matchData),giftList:h(this._giftList),cogiftList:_(this._cogiftList),enableComment:1==t.feedback_flag&&-1<["qq","wx"].indexOf(GY.browser.client)}}},{key:"_getMoneyOptions",value:function(){var t=this._data.base,n=w(t),e=this._yqj?H(f,st(t.ext_donate&&t.ext_donate.yqj)):H(p,st(t.ext_donate&&t.ext_donate.def));return n?e.map(function(t){return{text:j(t,n,{sep:" "}),money:t}}):e.map(function(t){return{text:v(t)+" 元",money:t}})}},{key:"_gyUnit",get:function(){return w(this._data.base)}}]),e}();function dt(t){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ut(t,n){return!n||"object"!==dt(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):n}function pt(t,n,e){return(pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=ft(t)););return t}(t,n);if(a){var o=Object.getOwnPropertyDescriptor(a,n);return o.get?o.get.call(e):o.value}})(t,n,e||t)}function ft(t){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,n){return(mt=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var gt=function(){function e(t){var n;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n=ut(this,ft(e).call(this,t)),!t.data||!t.data.base)throw new Error("缺少参数 `data.base`");return n._dother=t.dother,n._data=t.data,n._matchData=t.matchData,n._yqj=t.yqj,n._limit=t.limit,n._par=t.par,n._domId="pay-1v1-".concat(t.data.plan&&t.data.plan.plan),n._mtaParam="1v1",n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&mt(t,n)}(e,X(nt)),function(t,n,e){n&&yt(t.prototype,n),e&&yt(t,e)}(e,[{key:"_showPay",value:function(){if(this._tplData=this._tplData||this._mapToTplData(),this._payLayer=$("#".concat(this._domId)),!this._payLayer.length){var t=function(t){var n=t.domId,e=t.agree,a=t.anonymous,o=t.money,i=t.aidIntro,c=t.aided,r=t.title,s=t.fundName,l=t.avatar,d=t.shouldBlur;return'\n    <div class="gy-paylayer" id="'.concat(n,'">\n      <div class="gy-paylayer-mask"></div>\n      <div class="gy-paylayer-box">\n        <div class="gy-paylayer-head">\n          <div class="gy-paylayer-head-cover">\n            <img src="').concat(l,'" ').concat(d?'class="blur"':"",">\n            ").concat(d?'<b class="text">保护受助人隐私<br>完整信息<br>仅捐助人可见</b>':"",'\n          </div>\n          <div class="gy-paylayer-head-m">\n            <p class="gy-paylayer-head-title"><b>').concat(c,'</b></p>\n            <p class="gy-paylayer-head-desc">').concat(i,'</p>\n            <p class="gy-paylayer-head-amount"><b class="gy-paylayer-head-amount-unit">￥</b><span class="gy-paylayer-dinc j-money">').concat(v(o),'</span></p>\n          </div>\n        </div>\n\n        <div class="gy-paylayer-main">\n          <p class="gy-paylayer-desc">捐助项目 <span class="clr_dk">').concat(r,'</span><br>捐款由 <span class="clr_dk">').concat(s,'</span> 接收</p>\n        </div>\n\n        <div class="gy-paylayer-checkarea">\n          <div class="gy-paylayer-cell j-agreement">\n            <div>\n              <label class="gy-paylayer-checkbox">\n                <input type="checkbox" ').concat(e?"checked":"",' />\n                <i class="gy-paylayer-checkbox-icon">\n                  <svg viewBox="0 0 38 38" class="gy-paylayer-checkbox-icon-s">\n                    <path d="M16.9,20.5l8.5-8.5l2.8,2.8l-8.5,8.5l-2.8,2.8l-7.1-7.1l2.8-2.8L16.9,20.5z"/>\n                  </svg>\n                </i>\n              </label>\n            </div>\n            <div class="gy-paylayer-cell-m">\n              <div>同意&nbsp;<a href="http://gongyi.qq.com/m/html5/about_1.htm" class="gy-paylayer-protocol">用户捐赠协议</a></div>\n            </div>\n          </div>\n          <div class="gy-paylayer-cell j-anonymous">\n            <div>\n              <label class="gy-paylayer-checkbox">\n                <input type="checkbox" ').concat(a?"checked":"",' />\n                <i class="gy-paylayer-checkbox-icon">\n                  <svg viewBox="0 0 38 38" class="gy-paylayer-checkbox-icon-s">\n                    <path d="M16.9,20.5l8.5-8.5l2.8,2.8l-8.5,8.5l-2.8,2.8l-7.1-7.1l2.8-2.8L16.9,20.5z"/>\n                  </svg>\n                </i>\n              </label>\n            </div>\n            <div class="gy-paylayer-cell-m">\n              <div>匿名捐助</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="gy-paylayer-fbtnbar">\n          <button class="gy-paylayer-fbtn gy-paylayer-fbtn_dft j-pay" data-mtav="submit">确定</button>\n        </div>\n        <div class="gy-paylayer-close" data-mtav="close"></div>\n      </div>\n    </div>\n  ')}(this._tplData);this._container.append(t)}this._payLayer=$("#".concat(this._domId)),this._attachEvent(),this._payLayer.addClass("show")}},{key:"show",value:function(t){var n=(0<arguments.length&&void 0!==t?t:{}).calm,e=this._data.base,a=this;n?GY.wd.calm.wPay({pid:e.id,is_data:!0,data:e,success:function(){a._showPay()},dother:"function"==typeof a._dother?a._dother:null}):a._showPay()}},{key:"_pay",value:function(){if(function(t){var n=/(iphone)|(ipad)|(ipod)/i.test(window.navigator.userAgent),e=window.navigator.userAgent.match(/MicroMessenger\/([\d.]+)/i),a=e&&1<e.length?e[1]:-1;return n&&function(t,n){var e,a,o,i;if(t==n||-1==t)return 0;t=String(t).split("."),n=String(n).split(".");try{for(e=0,a=Math.max(t.length,n.length);e<a;e++){if((o=isFinite(t[e])&&Number(t[e])||0)<(i=isFinite(n[e])&&Number(n[e])||0))return-1;if(i<o)return 1}}catch(t){return-1}return 0}(a,t)<0}("5.3.1"))GY.wd.dialog.dialog({msg:"很抱歉，您的微信版本过低，暂不支持公益捐赠，请下载安装最新的微信版本客户端。",btnText:"马上下载",callback:function(){location.href="https://itunes.apple.com/cn/app/wei-xin/id414478124?mt=8"}});else{var t=this._tplData,n=t.agree,e=t.money,a=this._payLayer.find(".j-money").text();if(console.log("您将捐出".concat(e,"分")),!n)return GY.wd.dialog.dialog({msg:"同意并接受《用户捐赠协议》"});if(S(a)&&M(e)){var o=this._getPayPar();GY.Busi.pay.ENTRY_URL="/cgi-bin/1V1HelpDonateEntry.fcgi",GY.Busi.pay.paySubmit(o),this._payLayer.removeClass("show"),window.WeixinJSBridge&&WeixinJSBridge.invoke?i():document.addEventListener("WeixinJSBridgeReady",i,!1)}}function i(){try{wx.miniProgram.getEnv(function(t){t&&t.miniprogram&&($("#weui_confirm").hide(),GY.wd.dialog.hideLoading(),wx.miniProgram.navigateTo({url:"/nav_pages/pay/1v1?".concat(GY.Util.object.toStr(o))}))})}catch(t){console.log(t)}}}},{key:"_getPayPar",value:function(){var t=this._tplData.money,n=this._data,e=n.base,a=n.plan,o={money:v(t),smoney:""+v(t),actid:e.id,planid:a.plan,anon:this._tplData.anonymous?1:0,g_tk:GY.Busi.authorize.encodeToken(),gysts:GY.Busi.authorize.encodeToken()},i=GY.Util.uri.getUriPar("et")||"1v1one",c=GY.Util.uri.getUriPar("gt");return i&&(o.et=i),c&&(o.gt=c),$.extend(o,this._par),o}},{key:"_attachEvent",value:function(){if(!this._payLayer.data("init")){pt(ft(e.prototype),"_attachEvent",this).call(this);var t=this;t._eventHandlers.pay=t._eventHandlers.pay||function(){t._payLayer.hasClass("show")&&t._pay()},t._container.on("click","#".concat(this._domId," .j-pay"),t._eventHandlers.pay),t._payLayer.data("init",!0)}}},{key:"_mapToTplData",value:function(){var t=this._data.base||{},n=this._data.plan||{};return{avatar:A(n.avatar),aided:A(n.name)||"受助对象",title:A(t.title),fundName:A(t.fundName),money:n.expense,aidIntro:A(n.aidIntro),anonymous:!1,agree:!0,domId:this._domId,shouldBlur:1==n.type}}}]),e}();function ht(t){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function vt(t,n){return!n||"object"!==ht(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):n}function bt(t,n,e){return(bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=wt(t)););return t}(t,n);if(a){var o=Object.getOwnPropertyDescriptor(a,n);return o.get?o.get.call(e):o.value}})(t,n,e||t)}function wt(t){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t,n){return(kt=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var jt=function(){function c(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=n.data,a=n.dother,o=n.success,i=n.par;if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,c),t=vt(this,wt(c).call(this,{data:e,success:o})),!e||!e.base)throw new Error("缺少参数 `data.base`");return t._dother=a,t._success=o,t._data=e,t._par=i,t._domId="month-sign-".concat(e.base.id),t._mtaParam=t._gyUnit?"umonthsign":"monthsign",t}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&kt(t,n)}(c,X(nt)),function(t,n,e){n&&_t(t.prototype,n),e&&_t(t,e)}(c,[{key:"_showPay",value:function(){if(this._tplData=this._tplData||this._mapToTplData(this._data),this._payLayer=$("#".concat(this._domId)),!this._payLayer.length){var t=function(t){var n=t.projPic,e=t.aided,a=t.money,o=t.moneyOptions,i=t.month,c=t.monthOptions,r=t.agree,s=t.gyUnit,l=t.domId,d=o.every(function(t){return t.money!=a}),y=k(a,s);return'\n    <div class="gy-paylayer" id="'.concat(l,'">\n      <div class="gy-paylayer-mask"></div>\n      <div class="gy-paylayer-box">\n        <div class="gy-paylayer-head">\n          <div class="gy-paylayer-head-cover">\n            <img src="').concat(n,'" alt=""/>\n          </div>\n          <div class="gy-paylayer-head-m">\n            <p class="gy-paylayer-head-title"><b>为').concat(e,'捐出</b></p>\n            <p class="gy-paylayer-head-desc" style="').concat(0<y?"":"display:none",'">\n              每月<span class="j-unit">').concat(0<y?"".concat(y).concat(s.unit):"",'</span> / <span class="j-span">').concat(D(i),'</span>\n            </p>\n            <p class="gy-paylayer-head-amount"><b class="gy-paylayer-head-amount-unit">￥</b><span class="gy-paylayer-dinc j-money">').concat(v(a),'</span>/月</p>\n          </div>\n        </div>\n        <div class="gy-paylayer-main">\n          <div class="gy-paylayer-cell j-choose-amount">\n          ').concat(o.map(function(t,n){return'\n              <div class="gy-paylayer-cell-m gy-paylayer-mbtn '.concat(t.money==a?"current":"",'" data-money="').concat(t.money,'" data-mtav="amount').concat(n+1,'">').concat(t.text,"</div>\n            ")}).join(""),'\n          </div>\n          <div class="gy-paylayer-cell j-choose-amount">\n            <div class="gy-paylayer-cell-m gy-paylayer-mbtn gy-paylayer-mbtn_custom ').concat(d?"current":"",'" data-mtav="amountInput">\n              <span class="gy-paylayer-mbtn-unit">￥</span>\n              <input class="gy-paylayer-mbtn-input" type="number" pattern="[0-9.]*" placeholder="自定金额">\n            </div>\n            <div data-mtav="rand">\n              <a href="javascript:;" class="gy-paylayer-random">\n                <svg class="gy-paylayer-icomini" viewBox="0 0 48 48" fill-rule="evenodd"><path d="M37.5196,15.4804 L34.5996,18.4004 C35.4796,20.0804 35.9996,21.9804 35.9996,24.0004 C35.9996,30.6184 30.6196,36.0004 23.9996,36.0004 L23.9996,30.0004 L15.9996,38.0004 L23.9996,46.0004 L23.9996,40.0004 C32.8396,40.0004 39.9996,32.8404 39.9996,24.0004 C39.9996,20.8604 39.0796,17.9404 37.5196,15.4804 M23.9996,12.0004 L23.9996,18.0004 L31.9996,10.0004 L23.9996,2.0004 L23.9996,8.0004 C15.1596,8.0004 7.9996,15.1604 7.9996,24.0004 C7.9996,27.1404 8.9196,30.0604 10.4796,32.5204 L13.3996,29.6004 C12.4996,27.9384 11.9996,26.0204 11.9996,24.0004 C11.9996,17.3804 17.3796,12.0004 23.9996,12.0004"></path></svg>随缘\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class="gy-paylayer-time">\n          <p class="gy-paylayer-cell-title"><b>捐助时长</b></p>\n          <div class="gy-paylayer-cell j-choose-time">\n          ').concat(c.map(function(t,n){return'\n              <div class="gy-paylayer-cell-m gy-paylayer-mbtn '.concat(t.month==i?"current":"",'" data-month="').concat(t.month,'" data-mtav="months').concat(n+1,'">').concat(t.text,"</div>\n            ")}).join(""),'\n          </div>\n        </div>\n        <div class="gy-paylayer-checkarea">\n          <div class="gy-paylayer-cell j-agreement">\n            <div>\n              <label class="gy-paylayer-checkbox">\n                <input type="checkbox" ').concat(r?"checked":"",' />\n                <i class="gy-paylayer-checkbox-icon">\n                  <svg viewBox="0 0 38 38" class="gy-paylayer-checkbox-icon-s">\n                    <path d="M16.9,20.5l8.5-8.5l2.8,2.8l-8.5,8.5l-2.8,2.8l-7.1-7.1l2.8-2.8L16.9,20.5z"/>\n                  </svg>\n                </i>\n              </label>\n            </div>\n            <div class="gy-paylayer-cell-m">\n              <div>同意&nbsp;<a href="http://gongyi.qq.com/m/html5/about_1.htm" class="gy-paylayer-protocol">用户捐赠协议</a>&nbsp;和&nbsp;<a href="http://gongyi.qq.com/m/html5/about_2.htm" class="gy-paylayer-protocol">委托代扣协议</a>&nbsp;(可随时取消)</div>\n            </div>\n          </div>\n        </div>\n        <div class="gy-paylayer-fbtnbar">\n          <button class="gy-paylayer-fbtn gy-paylayer-fbtn_dft j-pay" data-mtav="submit">确定</button>\n        </div>\n        <div class="gy-paylayer-close" data-mtav="close"></div>\n      </div>\n    </div>\n  ')}(this._tplData);this._container.append(t)}this._payLayer=$("#".concat(this._domId)),this._attachEvent(),this._payLayer.addClass("show")}},{key:"show",value:function(t){var n=(0<arguments.length&&void 0!==t?t:{}).calm,e=this._data.base,a=this;n?GY.wd.calm.wPay({pid:e.id,is_data:!0,data:e,success:function(){a._showPay()},dother:"function"==typeof a._dother?a._dother:null}):a._showPay()}},{key:"_pay",value:function(){var t=this._tplData,n=t.agree,e=t.month,a=t.money;console.log("您将捐出".concat(a,"分/月, 连续").concat(e,"个月"));var o=this._payLayer.find(".j-money").text();if(!n)return GY.wd.dialog.dialog({msg:"同意并接受《用户捐赠协议》和《委托代扣协议》"});if(S(o)&&L(a)){var i=this,c=this._data.base.id;!function(t,n){var e=1<arguments.length&&void 0!==n?n:{},a=e.onSuccess,o=e.onFail,i=e.onError;GY.Busi.authorize.login({callback:function(){U({url:"/cgi-bin/WXEntrustSignV2",data:$.extend(t,{from:"h5"}),login:!0,success:function(t){"function"==typeof a&&a(t)},fail:function(t){"function"==typeof o&&o(t)},error:function(t){"function"==typeof i&&i(t)}})}})}({oid:GY.user.uid,actid:c,span:e,money:a,req:"qry",from:"h5"},{onSuccess:function(t){if(0==t.status&&("sign"==t.type||"service_sign"==t.type))return window.location.href="/m/weixin/month_thanks.html?pid="+c+"&money="+a+"&month="+e+"&et="+(GY.Util.uri.getUriPar("et")||"")+"&gt="+(i._par&&i._par.sgt||GY.Util.uri.getUriPar("gt")||"");if(98==t.status)return window.location.href="/m/weixin/month_plan.html#id="+c;if(95==t.status||97==t.status){GY.Busi.pay.ENTRY_URL="/cgi-bin/WXMonthlyDonateEntryV2";var n={busi_type:"WXSM",desc:"WXSM",bank_type:"8001",oid:GY.user.uid,actid:c,span:e,money:v(a),smoney:o};$.extend(n,i._par),GY.Busi.pay.paySubmit(n),GY.wd.dialog.loading({msg:"支付中...",isText:1}),i._payLayer.removeClass("show")}},onFail:function(a){i._payLayer.removeClass("show");U({url:"//scdn.gongyi.qq.com/json_data/cfgsets/gycfg_62_v0.json",noCheckCode:!0,cache:!0,dataType:"json",success:function(t){var n=(0<arguments.length&&void 0!==t?t:{}).data,e=void 0===n?{}:n;try{i._isMonthUpgrading=0<=e.monthUpgrade.pid.indexOf(i._data.base.id)}catch(t){console.log(t)}i._isMonthUpgrading?GY.wd.dialog.dialog({msg:"该项目服务升级中，暂时无法开通月捐，您可以捐赠其他公益项目，或明天再尝试。如有疑问请咨询公益机构。"}):GY.wd.dialog.dialog({msg:"系统错误 ("+a.code+")"})},error:function(){GY.wd.dialog.dialog({msg:"系统错误 ("+a.code+")"})}})}})}}},{key:"_pickRandomMoney",value:function(){return b(y)}},{key:"_attachEvent",value:function(){if(!this._payLayer.data("init")){bt(wt(c.prototype),"_attachEvent",this).call(this);var t=this;t._eventHandlers.pay=t._eventHandlers.pay||function(){t._payLayer.hasClass("show")&&t._pay()},t._container.on("click","#".concat(t._domId," .j-pay"),t._eventHandlers.pay),t._payLayer.data("init",!0)}}},{key:"_mapToTplData",value:function(t){var n,e=(0<arguments.length&&void 0!==t?t:{}).base,a=w(e),o=(n=H(m,function(t){return t&&t.length?t.filter(function(t){return 100<=t}):[]}(e.ext_donate&&e.ext_donate.month)),a?n.map(function(t){return{text:j(t,a,{sep:" "}),money:t}}):n.map(function(t){return{text:v(t)+" 元",money:t}}));return{projPic:A(e.listImg).replace(/\/\d+$/,"")+"/0",aided:A(e.ext_donate&&e.ext_donate.targ||"受助对象"),money:o[0].money,month:u[0].month,moneyOptions:o,monthOptions:u,agree:!0,gyUnit:a,domId:this._domId}}},{key:"_gyUnit",get:function(){return w(this._data.base)}}]),c}();function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dt(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Lt(t,n){return!n||"object"!==xt(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):n}function St(t){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mt(t,n){return(Mt=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var Ot=function(t){return function(){function i(t){var n;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i),n=Lt(this,St(i).call(this,t));var e=t.data,a=t.success,o=t.error;if(!e||!e.donate_info)throw new Error("缺少参数 `data.donate_info`");return n._pid=e.donate_info.actid,n._data=e,n._cgiTime=0,n._success=a,n._error=o,n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&Mt(t,n)}(i,t),function(t,n,e){n&&Dt(t.prototype,n),e&&Dt(t,e)}(i,[{key:"_getMonthInfo",value:function(t,n){var e=0<arguments.length&&void 0!==t?t:{},a=e.onSuccess,o=e.onFail,i=e.onError,c=1<arguments.length&&void 0!==n?n:{},r=c.type,s=c.callCgi,l=this;if(!s&&this._data)return a();R({pid:this._pid,type:r||"getmddetail"},{onSuccess:function(t){l._data=t,"function"==typeof a&&a()},onFail:o,onError:i})}},{key:"_checkMonthInfo",value:function(){var a=this,t=a._monthData,o=t.money,i=t.closeTime,c=setTimeout(function(){a._getMonthInfo({onSuccess:function(){a._cgiTime++;var t=a._monthData,n=t.money,e=t.closeTime;return n!=o||e!=i?(N({onSuccess:function(){try{MtaH5.clickStat("donate_box_1811",function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}({},a._mtaParam,"modSuccess"))}catch(t){}}}),GY.wd.dialog.dialog({msg:"月捐计划修改成功",callback:function(){"function"==typeof a._success?a._success(a._data):window.location.href="/m/weixin/month_plan.html#id=".concat(a._pid)}})):a._cgiTime<=5?a._checkMonthInfo():(clearTimeout(c),void GY.wd.dialog.dialog({msg:"系统正在修改中...",callback:function(){"function"==typeof a._error?a._error():window.location.href="/user_center/month.htm"}}))},onFail:function(t){if(100==t.ret)return GY.wd.dialog.dialog({msg:"您在微信支付关掉了该项目的自动扣费，请取消月捐后再重新开通。"});GY.wd.dialog.dialog({msg:"系统错误.(".concat(t.ret,":").concat(t.msg,")")})},onError:function(){GY.wd.dialog.dialog({msg:"系统错误."})}},{type:"getmd",callCgi:!0})},1e3)}},{key:"_modifyMonthDonate",value:function(t){var n=0<arguments.length&&void 0!==t?t:{},e=n.money,a=n.month,o=n.bspan,i=n.bmoney;if(L(e)&&O(a)){console.log("月捐计划即将调整为".concat(e,"分/月, 共").concat(a,"个月"));var c=this;!function(t,n){var e=0<arguments.length&&void 0!==t?t:{},a=e.pid,o=e.money,i=e.month,c=e.type,r=e.bmoney,s=e.bspan,l=1<arguments.length&&void 0!==n?n:{},d=l.onSuccess,y=l.onFail,u=l.onError;GY.Busi.authorize.login({callback:function(){U({url:"/cgi-bin/gywp_WXModifyMonthlyPlan",data:"user_close"===c?{oid:GY.user.uid,op:"user_close",actid:a}:{oid:GY.user.uid,op:"modify_plan",actid:a,span:i,money:o,bmoney:r,bspan:s,appid:"wxc0db45f411664b2e"},type:"POST",login:!0,dataType:"json",success:function(t){"function"==typeof d&&d(t)},fail:function(t){"function"==typeof y&&y(t)},error:function(){"function"==typeof u&&u()}})}})}({pid:this._pid,money:e,month:Math.min(a,x),bspan:o,bmoney:i,type:"modify_plan"},{onSuccess:function(t){GY.wd.dialog.loading({msg:"正在提交修改"}),c._checkMonthInfo()},onFail:function(t){GY.wd.dialog.dialog({msg:"修改失败 (".concat(t.code,")")})}})}}},{key:"_monthData",get:function(){return function(){var t,n=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).donate_info||{},e=new Date(n.open_time.replace(/-/g,"/")),a=n.close_time?new Date(n.close_time.replace(/-/g,"/")):"",o=new Date;a?a<o?t=Math.max(n.month-1,0)||0:(t=12*(a.getFullYear()-o.getFullYear())+a.getMonth()-o.getMonth(),o.getDate()>=e.getDate()&&(t-=1)):t=0;var i=12*(o.getFullYear()-e.getFullYear())+o.getMonth()-e.getMonth();o.getDate()>=e.getDate()&&(i+=1);a&&a<o&&(i=n.month);return{openTime:e,closeTime:a,money:+n.money||0,done:i,remaining:t,accMonth:n.total_count,startDate:n.earliest_date}}(this._data)}},{key:"_gyUnit",get:function(){return w(this._data.donate_info)}}]),i}()};function Gt(t){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pt(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Yt(t,n){return!n||"object"!==Gt(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):n}function Ct(t,n,e){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Tt(t)););return t}(t,n);if(a){var o=Object.getOwnPropertyDescriptor(a,n);return o.get?o.get.call(e):o.value}})(t,n,e||t)}function Tt(t){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Et(t,n){return(Et=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var It=function(){function e(t){var n;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Yt(this,Tt(e).call(this,t)))._cgiTime=0,n._domId="month-renew-".concat(t.data.donate_info.actid),n._mtaParam="monthrenew",n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&Et(t,n)}(e,Ot(nt)),function(t,n,e){n&&Pt(t.prototype,n),e&&Pt(t,e)}(e,[{key:"show",value:function(){if(this._tplData=this._tplData||this._mapToTplData(this._data),this._payLayer=$("#".concat(this._domId)),!this._payLayer.length){var t=function(t){var n=t.projPic,e=t.aided,a=t.money,o=t.month,i=t.remaining,c=t.options,r=t.gyUnit,s=t.domId,l=k(a,r);return'\n    <div class="gy-paylayer" id="'.concat(s,'">\n      <div class="gy-paylayer-mask"></div>\n      <div class="gy-paylayer-box">\n        <div class="gy-paylayer-head">\n          <div class="gy-paylayer-head-cover">\n            <img src="').concat(n,'" alt=""/>\n          </div>\n          <div class="gy-paylayer-head-m">\n            <p class="gy-paylayer-head-title"><b>为').concat(e,'捐出</b></p>\n            <p class="gy-paylayer-head-desc" style="').concat(0<l?"":"display:none",'">\n              每月<span class="j-unit">').concat(0<l?"".concat(l).concat(r.unit):"",'</span> / <span class="j-span">').concat(D(o+i),'</span>\n            </p>\n            <p class="gy-paylayer-head-amount"><b class="gy-paylayer-head-amount-unit">￥</b><span class="gy-paylayer-dinc j-money">').concat(v(a),'</span>/月</p>\n          </div>\n        </div>\n        <div class="gy-paylayer-time">\n          <p class="gy-paylayer-cell-title"><b>增加月数</b></p>\n          <div class="gy-paylayer-cell j-choose-time">\n          ').concat(c.map(function(t,n){return'\n              <div class="gy-paylayer-cell-m gy-paylayer-mbtn '.concat(t.month==o?"current":"",'" data-month="').concat(t.month,'" data-mtav="months').concat(n+1,'">\n                ').concat("不限期"===t.text?"不限期":"+".concat(t.text),"\n              </div>\n            ")}).join(""),'\n          </div>\n        </div>\n        <div class="gy-paylayer-fbtnbar">\n          <button class="gy-paylayer-fbtn gy-paylayer-fbtn_dft j-submit" data-mtav="submit">确定</button>\n        </div>\n        <div class="gy-paylayer-close" data-mtav="close"></div>\n      </div>\n    </div>\n  ')}(this._tplData);this._container.append(t)}this._payLayer=$("#".concat(this._domId)),this._attachEvent(),this._payLayer.addClass("show")}},{key:"_submit",value:function(){console.log("您增加了".concat(this._tplData.month,"个月"));var t=this._monthData,n=t.done,e=t.remaining;this._modifyMonthDonate({money:this._tplData.money,bmoney:this._tplData.money,month:Math.min(this._tplData.month+n+e,x),bspan:n+e})}},{key:"_attachEvent",value:function(){if(!this._payLayer.data("init")){Ct(Tt(e.prototype),"_attachEvent",this).call(this);var t=this;t._eventHandlers.submit=t._eventHandlers.submit||function(){t._payLayer.hasClass("show")&&t._submit()},t._container.on("click","#".concat(t._domId," .j-submit"),t._eventHandlers.submit),t._payLayer.data("init",!0)}}},{key:"_mapToTplData",value:function(t){var n=(0<arguments.length&&void 0!==t?t:{}).donate_info,e=this._gyUnit,a=n||{},o=u;return{projPic:A(a.acturl).replace(/\/\d+$/,"")+"/0",aided:A(n.ext_donate&&n.ext_donate.targ||"受助对象"),money:a.money,month:o[0].month,options:o,gyUnit:e,remaining:this._monthData.remaining||0,domId:this._domId}}}]),e}();function Bt(t){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function At(t,n){return!n||"object"!==Bt(n)&&"function"!=typeof n?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):n}function Ht(t,n,e){return(Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=$t(t)););return t}(t,n);if(a){var o=Object.getOwnPropertyDescriptor(a,n);return o.get?o.get.call(e):o.value}})(t,n,e||t)}function $t(t){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nt(t,n){return(Nt=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}var Ft=function(){function e(t){var n;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),(n=At(this,$t(e).call(this,t)))._domId="month-modify-money-".concat(t.data.donate_info.actid),n._mtaParam="monthmodmoney",n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&Nt(t,n)}(e,Ot(nt)),function(t,n,e){n&&Ut(t.prototype,n),e&&Ut(t,e)}(e,[{key:"show",value:function(){if(this._tplData=this._tplData||this._mapToTplData(this._data),this._payLayer=$("#".concat(this._domId)),!this._payLayer.length){var t=function(t){var n=t.projPic,e=t.aided,a=t.money,o=t.remaining,i=t.gyUnit,c=t.domId,r=k(a,i);return'\n    <div class="gy-paylayer" id="'.concat(c,'">\n      <div class="gy-paylayer-mask"></div>\n      <div class="gy-paylayer-box">\n        <div class="gy-paylayer-head">\n          <div class="gy-paylayer-head-cover">\n            <img src="').concat(n,'" alt=""/>\n          </div>\n          <div class="gy-paylayer-head-m">\n            <p class="gy-paylayer-head-title"><b>为').concat(e,'捐出</b></p>\n            <p class="gy-paylayer-head-desc" style="').concat(0<r?"":"display:none",'">\n              每月<span class="j-unit">').concat(0<r?"".concat(r).concat(i.unit):"",'</span> / <span class="j-span">').concat(D(o),'</span>\n            </p>\n            <p class="gy-paylayer-head-amount"><b class="gy-paylayer-head-amount-unit">￥</b><span class="gy-paylayer-dinc j-money">').concat(v(a),'</span>/月</p>\n          </div>\n        </div>\n        <div class="gy-paylayer-main">\n          <p class="gy-paylayer-cell-title"><b>每月捐助金额</b></p>\n          <div class="gy-paylayer-cell j-choose-amount">\n            <div class="gy-paylayer-cell-m gy-paylayer-mbtn gy-paylayer-mbtn_custom" data-mtav="amountInput">\n              <span class="gy-paylayer-mbtn-unit">￥</span>\n              <input class="gy-paylayer-mbtn-input" type="number" pattern="[0-9.]*" placeholder="输入每月捐款金额">\n            </div>\n            <div>\n              <a href="javascript:;" class="gy-paylayer-random" data-mtav="rand">\n                <svg class="gy-paylayer-icomini" viewBox="0 0 48 48" fill-rule="evenodd"><path d="M37.5196,15.4804 L34.5996,18.4004 C35.4796,20.0804 35.9996,21.9804 35.9996,24.0004 C35.9996,30.6184 30.6196,36.0004 23.9996,36.0004 L23.9996,30.0004 L15.9996,38.0004 L23.9996,46.0004 L23.9996,40.0004 C32.8396,40.0004 39.9996,32.8404 39.9996,24.0004 C39.9996,20.8604 39.0796,17.9404 37.5196,15.4804 M23.9996,12.0004 L23.9996,18.0004 L31.9996,10.0004 L23.9996,2.0004 L23.9996,8.0004 C15.1596,8.0004 7.9996,15.1604 7.9996,24.0004 C7.9996,27.1404 8.9196,30.0604 10.4796,32.5204 L13.3996,29.6004 C12.4996,27.9384 11.9996,26.0204 11.9996,24.0004 C11.9996,17.3804 17.3796,12.0004 23.9996,12.0004"></path></svg>随缘\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class="gy-paylayer-fbtnbar">\n          <button class="gy-paylayer-fbtn gy-paylayer-fbtn_dft j-submit" data-mtav="submit">确定</button>\n        </div>\n        <div class="gy-paylayer-close" data-mtav="close"></div>\n      </div>\n    </div>\n  ')}(this._tplData);this._container.append(t)}this._payLayer=$("#".concat(this._domId)),this._attachEvent(),this._payLayer.addClass("show")}},{key:"_submit",value:function(){var t=this._tplData.money,n=this._payLayer.find(".j-money").text();if(console.log("您将捐出".concat(t,"分/月")),S(n)){if(!this._modified)return GY.wd.dialog.dialog({msg:"月捐金额未发生更改"});var e=this._monthData,a=e.done,o=e.remaining;this._modifyMonthDonate({bmoney:this._data.donate_info.money,bspan:a+o,money:t,month:a+o})}}},{key:"_pickRandomMoney",value:function(){return b(y)}},{key:"_attachEvent",value:function(){if(!this._payLayer.data("init")){Ht($t(e.prototype),"_attachEvent",this).call(this);var t=this;t._eventHandlers.submit=t._eventHandlers.submit||function(){t._payLayer.hasClass("show")&&t._submit()},t._container.on("click","#".concat(t._domId," .j-submit"),t._eventHandlers.submit),t._payLayer.data("init",!0)}}},{key:"_mapToTplData",value:function(t){var n=(0<arguments.length&&void 0!==t?t:{}).donate_info,e=n||{},a=this._gyUnit;return{projPic:A(e.acturl).replace(/\/\d+$/,"")+"/0",aided:A(n.ext_donate&&n.ext_donate.targ||"受助对象"),money:e.money,remaining:this._monthData.remaining||0,gyUnit:a,domId:this._domId}}},{key:"_modified",get:function(){return this._data.donate_info.money!=this._tplData.money}}]),e}(),Rt=GY.Util.uri;l.find(),function(t){T()&&GY.Busi.js_conf.init();var s={},l={},w={};function k(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.pid,e=t.data,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=a.onSuccess,i=a.onFail,c=a.onError,r=2<arguments.length?arguments[2]:void 0;if(!(n=n||e&&e.base&&e.base.id))throw new Error("找不到项目 id");return s[n]&&!r&&"function"==typeof o?o(s[n]):e&&e.base&&!r&&"function"==typeof o?(s[n]=e,o(e)):void function(t,n){var e=(0<arguments.length&&void 0!==t?t:{}).pid,a=1<arguments.length&&void 0!==n?n:{},o=a.onSuccess,i=a.onFail,c=a.onError;if(!e)throw new Error("缺少参数 `pid`");if(function(t){return 1e8<=t}(e))return r();function r(){U({url:"/cgi-bin/ProjInfoQuery.fcgi",data:{id:e,type:"proj_base"},dataType:"json",success:function(t){"function"==typeof o&&o(t.msg)},fail:i,error:c})}U({url:"".concat(F,"/json_data/data_detail/").concat(e%100,"/detail.").concat(e,".js"),jsonpCallback:"_cb_fn_proj_"+e,success:function(t){"function"==typeof o&&o(t)},error:r})}({pid:n},{onSuccess:function(t){s[n]=t,"function"==typeof o&&o(t)},onFail:i,onError:c})}function j(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.pid,e=t.type,a=t.data,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.onSuccess,c=o.onFail,r=o.onError,s=2<arguments.length?arguments[2]:void 0;if(!(n=n||a&&a.donate_info&&a.donate_info.actid))throw new Error("找不到项目 id");return l[n]&&!s&&"function"==typeof i?i(l[n]):a&&a.donate_info&&!s&&"function"==typeof i?(l[n]=a,i(a)):void R({pid:n,type:e},{onSuccess:function(t){l[n]=t,"function"==typeof i&&i(t)},onFail:c,onError:r})}t.extend("wd.donateBox",{init:function(){var a,o,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.type,n=t.data,c=t.matchData,r=t.giftData,s=t.cogiftData,l=t.pid,d=t.limit,y=t.validators,u=t.par,p=t.getMoneyDesc,f=t.dother,m=t.close,g=t.success,h=t.error,_=t.getWd,v=t.customPayMethod;if(!i)throw new Error("缺少参数 `type`");if(["MONTH","ONCE","YQJ","MONTH_SIGN","MONTH_RENEW","MONTH_MOD_MONEY","1V1"].indexOf(i)<0)throw new Error('"'.concat(i,'" 不是 `type` 参数的有效取值'));if(!l&&!n)throw new Error("缺少参数 `pid` 或 `data`");if(l&&n)throw new Error("请勿同时传入 `pid` 与 `data`");if(!(l=l||n&&(n.base&&n.base.id||n.donate_info&&n.donate_info.actid)))throw new Error("找不到项目 id");if("1V1"==i){var e=n.plan&&n.plan.plan;e&&(a="".concat(i).concat(e))}else if("YQJ"==i){var b=Rt.getUriPar("did")||Rt.getHashPar("did")||"";a="".concat(i).concat(l).concat(b,"limit").concat(d||"")}else a="".concat(i).concat(l);if(w[a])return _(w[a]);k({pid:l,data:n},{onSuccess:function(t){var e=t.base;return 0<=["ONCE","YQJ"].indexOf(i)?(o=new lt({data:{base:e},matchData:c,giftData:r,cogiftData:s,yqj:"YQJ"===i,wdKey:a,limit:d,validators:y,par:u,getMoneyDesc:p,dother:f,close:m,success:g,error:h,customPayMethod:v}),w[a]=o,void _(o)):"1V1"==i?(o=new gt({data:{base:e,plan:n.plan||{}},validators:y,par:u,getMoneyDesc:p,dother:f,close:m,success:g,error:h}),w[a]=o,void _(o)):void(1==e.wx_month&&"wx"==GY.browser.client?j({pid:l,data:n},{onSuccess:function(t){var n=t.donate_info;switch(i){case"MONTH":o=1==n.mlstatus?function(t){var n=new Date(t.open_time.replace(/-/g,"/")),e=t.close_time?new Date(t.close_time.replace(/-/g,"/")):"";return!e||12*(e.getFullYear()-n.getFullYear())+e.getMonth()-n.getMonth()>=x}(n)?new Ft({data:{donate_info:n},validators:y,getMoneyDesc:p,success:g,error:h,close:m}):new It({data:{donate_info:n},validators:y,getMoneyDesc:p,success:g,error:h,close:m}):new jt({data:{base:e},validators:y,par:u,dother:f,getMoneyDesc:p,success:g,error:h,close:m}),w[a]=o,_(o);break;case"MONTH_SIGN":if(1==n.mlstatus)return void _(null,{msg:"不能重复开通月捐"});o=new jt({data:{base:e},validators:y,par:u,getMoneyDesc:p,dother:f,success:g,error:h,close:m}),w[a]=o,_(o);break;case"MONTH_RENEW":if(1!=n.mlstatus)return void _(null,{msg:"尚未开通月捐"});o=new It({data:{donate_info:n},validators:y,getMoneyDesc:p,success:g,error:h,close:m}),w[a]=o,_(o);break;case"MONTH_MOD_MONEY":if(1!=n.mlstatus)return void _(null,{msg:"尚未开通月捐"});o=new Ft({data:{donate_info:n},validators:y,getMoneyDesc:p,success:g,error:h,close:m}),w[a]=o,_(o)}}}):_(null,{msg:"不是月捐项目, 或在非微信客户端下打开"}))}})},getProjInfo:k,getMonthInfo:j,MAX_MONTHS:x})}(GY)},o1g4:function(t,n,e){}});